<!DOCTYPE html>
<html>
  <head>
    <title>Sheets API</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <button id="Read" onclick="Read_Data(prompt('Please enter the sheet name'), prompt('Please enter the path or heading'));" style="visibility: hidden;" >Read Data</button>
    <button id="Update" onclick="Update_Data(prompt('Please enter the sheet name'), prompt('Please enter the column', 'A'), prompt('Please enter the row', '1'), prompt('Please enter the data to update', 'LALA'));"style="visibility: hidden;" >Update Data</button>
    <button id="Clear" onclick="Clear_Data(prompt('Please enter the sheet name'), prompt('Please enter the column', 'A'), prompt('Please enter the row', '1'));" style="visibility: hidden;" >Clear Data</button>
    <button id="Create" onclick="Create_Data(); alert('As data is not working by using prompt, so data is passed internally(in function). -By LL(luckylala)');" style="visibility: hidden;" >Create Data</button>

    <pre id="content" style="white-space: pre-wrap;"></pre>

    <script type="text/javascript">
      const CLIENT_ID = '463724458932-o3m1boo9p23k69nntv7l6ac5drcb3sba.apps.googleusercontent.com';
      const API_KEY = 'AIzaSyAXdwGN4T6QDFVz6aIC4YnKY-iVvUttqRM';
      const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
      const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';

      let tokenClient;
      let gapiInited = false;
      let gisInited = false;

      function gapiLoaded() {
        gapi.load('client', initializeGapiClient);
      }
      async function initializeGapiClient() {
        await gapi.client.init({
          apiKey: API_KEY,
          discoveryDocs: [DISCOVERY_DOC]
        });
        gapiInited = true;
        if (gisInited === true) {
          handleAuthClick();
        }
      }
      function gisLoaded() {
        tokenClient = google.accounts.oauth2.initTokenClient({
          client_id: CLIENT_ID,
          scope: SCOPES,
          callback: ''
        });
        gisInited = true;
        if (gapiInited === true) {
          handleAuthClick();
        }
      }
      function handleAuthClick() {
        tokenClient.callback = async (resp) => {
          if (resp.error !== undefined) {
            throw (resp);
          } else {
              document.getElementById('Read').style.visibility = 'visible';
              document.getElementById('Update').style.visibility = 'visible';
              document.getElementById('Clear').style.visibility = 'visible';
              document.getElementById('Create').style.visibility = 'visible';
              document.getElementById("authorize_button").remove();
          }
        };

        if (gapi.client.getToken() === null) {
          tokenClient.requestAccessToken({prompt: 'consent'});
        } else {
          tokenClient.requestAccessToken({prompt: ''});
        }
      }
      //async function Create_Data( sheet_name, Data ) {
        async function Create_Data() {
          try {
              var sheet_name = 'Accounts';
              var LALA = 'LALA';
              var Data = [LALA,LALA,LALA,LALA,LALA,LALA,LALA,LALA,LALA,LALA];
              await gapi.client.sheets.spreadsheets.values.append({

                  spreadsheetId: '1-jMb9tOG--iC9_onIXqK1LTWKGqs0H7iOTXDTu7W1gs',
                  range: sheet_name,
                  valueInputOption: 'RAW',
                  insertDataOption: 'INSERT_ROWS',
                  values: [ Data ]

              });
          } catch (err) { console.warn(err) }
      }

      async function Clear_Data( sheet_name, COLUMN, ROW ) {
          try {

              await gapi.client.sheets.spreadsheets.values.clear({

                  spreadsheetId: '1-jMb9tOG--iC9_onIXqK1LTWKGqs0H7iOTXDTu7W1gs',
                  range: sheet_name + '!' + COLUMN + ROW,

              });

          } catch (err) { console.warn(err) }
      }
      async function Read_Data(sheet_name, path) { let response;
        try {

            response = await gapi.client.sheets.spreadsheets.values.get({
            spreadsheetId: '1-jMb9tOG--iC9_onIXqK1LTWKGqs0H7iOTXDTu7W1gs',
            range: sheet_name });

        } catch (err) { console.warn(err); return; };

        const range = response.result;

        if (!range || !range.values || range.values.length == 0) {

            console.warn("An Error Takes Place..."); return;

        }; const output = range.values.reduce((str, row) => `${str}\n${row}`); // Please explain this...

        var result = new Array(); result = output.split('\n');
        var Headers = new Array(); Headers = result[0].split(',');
        var Final_Data = new Array();
        Single_User_Data = new Array(); All_User_Data = new Array();

        for ( var v = 1; v < result.length; v++ ) {

            All_User_Data.push( result[v].split(',') );

        }; for ( var a = 0; a < All_User_Data.length; a++ ) {

            Single_User_Data = All_User_Data[a];

            if ( Single_User_Data.length == Headers.length ) {

                var classify = new Object();

                for ( var s = 0; s < Headers.length; s++ ) {

                    classify[Headers[s]] = Single_User_Data[s];

                }; Final_Data.push(classify);

            } else { console.log("Error : Missing Details..."); }
        }; 
        Final_Data = JSON.stringify(Final_Data); 
        // sessionStorage.setItem(path, Final_Data);
        document.getElementById('content').innerText = (path + ': ' + Final_Data);
      }
      async function Update_Data( sheet_name, Column, Row, Data ) {
        try {

            await gapi.client.sheets.spreadsheets.values.update({

                spreadsheetId: '1-jMb9tOG--iC9_onIXqK1LTWKGqs0H7iOTXDTu7W1gs',
                range: ( sheet_name + '!' + Column + Row ),
                valueInputOption: 'RAW',
                values: [ [ Data ] ] // Data to Update in the Cell...

            });

        } catch (err) { console.warn(err.result.error); }
      }
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
  </body>
</html>
